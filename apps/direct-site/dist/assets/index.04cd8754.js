import{C as w,a as U,b,A as v,c as R,r as i,u as q,d as A,R as s,N as M,m as N,e as I,f as O,g as D,h as T,B as j}from"./vendor.ac6a385e.js";const k=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function r(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerpolicy&&(o.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?o.credentials="include":e.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(e){if(e.ep)return;e.ep=!0;const o=r(e);fetch(e.href,o)}};k();const F={UserPoolId:"ap-southeast-2_gw39jNQMX",ClientId:"58nmodulq3fcf1juh3gmjgfvog",Storage:new w({secure:!1,domain:window.location.hostname==="localhost"?"localhost":"lawnman.club"})},m=new U(F),B=async(t,n)=>await new Promise((r,l)=>{const e={Username:t,Password:n,Pool:m,Storage:new w({secure:!1,domain:window.location.hostname==="localhost"?"localhost":"lawnman.club"})},o=new b(e),a=new v({Username:t,Password:n});o.authenticateUser(a,{onSuccess:c=>{console.log("onSuccess: ",c),r(c)},onFailure:c=>{console.log("onFailure: ",c),l(c)},newPasswordRequired:c=>{console.log("newPasswordRequired: ",c),r(c)}})}),Q=async(t,n,r)=>{const l=new R({Name:"name",Value:r});m.signUp(t,n,[l],[],(e,o)=>{e&&console.error(e),console.log(o)})},V=()=>new Promise((t,n)=>{const r=m.getCurrentUser();r||n("No local user found."),r==null||r.getSession((l,e)=>{l||!e?n("User found, but could not get session data."):t(e)})}),_=async()=>{try{const t=m.getCurrentUser();t==null||t.signOut()}catch(t){console.error(t)}},E=i.exports.createContext({});function G({children:t}){const[n,r]=i.exports.useState(),[l,e]=i.exports.useState(),[o,a]=i.exports.useState(!1),[c,d]=i.exports.useState(!0),g=q(),S=A();i.exports.useEffect(()=>{l&&e(null)},[S.pathname]),i.exports.useEffect(()=>{V().then(u=>{r(u),console.log("inneruser",u)}).catch(u=>e(u)).finally(()=>d(!1))},[]);function C(u,p){a(!0),B(u,p).then(f=>{r(f),g("/")}).catch(f=>e(f)).finally(()=>a(!1))}function x(u,p,f){a(!0),Q(u,p,f).then(h=>{r(h),g("/")}).catch(h=>e(h)).finally(()=>a(!1))}function P(){a(!0),_().then(()=>{r(void 0),g("/")}).catch(u=>e(u)).finally(()=>a(!1))}const L=i.exports.useMemo(()=>({user:n,loading:o,error:l,performLogin:C,performSignup:x,performLogout:P}),[n,o,l]);return s.createElement(E.Provider,{value:L},!c&&t)}function y(){return i.exports.useContext(E)}function H(t){const{user:n}=y();return n?s.createElement(s.Fragment,null,t.children):window.location.host.split(".")[0]==="auth"?s.createElement(M,{to:"/login"}):(window.location.href="https://auth.lawnman.club",s.createElement(s.Fragment,null))}const K=()=>{const{user:t,performLogout:n}=y(),[r,l]=i.exports.useState("not connected");return i.exports.useEffect(()=>{const e="mqttjs_"+Math.random().toString(16).substr(2,8),o="ws://128.199.220.209:9001/mqtt",a={username:"juicebox",password:"dY*t7LSgGhc%M4",keepalive:60,clientId:e,protocolId:"MQTT",protocolVersion:4,clean:!0,reconnectPeriod:1e3,connectTimeout:30*1e3};console.log("Connecting mqtt client");const c=N.connect(o,a);c.on("connect",()=>{l("connected")}),c.on("error",d=>{console.log("Connection error: ",d),c.end()}),c.on("reconnect",()=>{console.log("Reconnecting...")})},[]),s.createElement(I,null,s.createElement(O,{path:"/",element:s.createElement(H,null,s.createElement("h1",null,"Direct Control Site MQTT: ",`Status: ${r}`),s.createElement("p",null,"Hellooo ",t==null?void 0:t.idToken.payload.email," "),s.createElement("button",{onClick:n},"Log Out!!!!!!!!"))}))};D.render(s.createElement(i.exports.StrictMode,null,s.createElement(T,null,s.createElement(j,null,s.createElement(G,null,s.createElement(K,null))))),document.getElementById("root"));
